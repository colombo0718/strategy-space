<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fruit Slot (GG Minimal)</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#121a33;
      --text:#e8ecff;
      --muted:#95a0c6;
      --accent:#7cf7ff;
      --danger:#ff7c93;
      --ok:#86ff9b;
    }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", Arial, sans-serif;
      background: radial-gradient(1000px 700px at 50% -10%, #1b2a60 0%, var(--bg) 55%);
      color:var(--text);
      display:flex;
      min-height:100vh;
      align-items:center;
      justify-content:center;
      padding:16px;
    }
    .wrap{
      width:min(720px, 96vw);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.14);
      border-radius:18px;
      padding:18px;
      box-shadow: 0 18px 50px rgba(0,0,0,.45);
    }
    header{
      display:flex;
      gap:12px;
      align-items:baseline;
      justify-content:space-between;
      margin-bottom:14px;
    }
    h1{
      font-size:18px;
      margin:0;
      letter-spacing:.2px;
    }
    .hint{
      font-size:12px;
      color:var(--muted);
      text-align:right;
      line-height:1.3;
    }
    .panel{
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      padding:14px;
    }
    .reels{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:12px;
      margin:12px 0 10px;
    }
    .reel{
      height:120px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(180deg, rgba(124,247,255,.10), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.12);
      border-radius:16px;
      font-size:64px;
      user-select:none;
    }
    .stats{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-top:10px;
    }
    .chip{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      border-radius:999px;
      padding:8px 12px;
      font-size:13px;
      color:var(--text);
    }
    .chip b{ color:var(--accent); }
    .msg{
      margin-top:10px;
      font-size:13px;
      color:var(--muted);
      min-height:18px;
    }
    .msg.good{ color:var(--ok); }
    .msg.bad{ color:var(--danger); }
    .controls{
      margin-top:12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    button{
      appearance:none;
      border:1px solid rgba(255,255,255,.18);
      background: linear-gradient(180deg, rgba(124,247,255,.20), rgba(124,247,255,.08));
      color:var(--text);
      padding:10px 14px;
      border-radius:12px;
      font-weight:700;
      cursor:pointer;
      user-select:none;
    }
    button:disabled{
      opacity:.55;
      cursor:not-allowed;
    }
    .small{
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.12);
      padding:2px 6px;
      border-radius:6px;
      color:var(--text);
      margin:0 3px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ğŸ‰ Fruit Slot â€” GG Minimal</h1>
      <div class="hint">
        GGï¼šA/Start = Spinï½œB = Reset<br/>
        éµç›¤ï¼š<span class="kbd">A</span>/<span class="kbd">Space</span>/<span class="kbd">Enter</span>ï½œResetï¼š<span class="kbd">B</span>
      </div>
    </header>

    <div class="panel">
      <div class="reels" aria-label="slot reels">
        <div class="reel" id="r0">ğŸ</div>
        <div class="reel" id="r1">ğŸŒ</div>
        <div class="reel" id="r2">ğŸ‡</div>
      </div>

      <div class="stats">
        <div class="chip">Scoreï¼š<b id="score">0</b></div>
        <div class="chip">Last Gainï¼š<b id="gain">0</b></div>
        <div class="chip">Spinsï¼š<b id="spins">0</b></div>
      </div>

      <div class="msg" id="msg">æŒ‰ A / Start é–‹å§‹ Spinã€‚</div>

      <div class="controls">
        <button id="btnSpin">SPIN (A / Start)</button>
        <button id="btnReset" style="background:linear-gradient(180deg, rgba(255,124,147,.20), rgba(255,124,147,.08));">RESET (B)</button>
      </div>

      <div class="small" style="margin-top:10px;">
        è¨ˆåˆ†ï¼šä¸‰é€£ <b style="color:var(--accent)">+100</b> ï½œå…©é€£ <b style="color:var(--accent)">+20</b> ï½œå…¶é¤˜ +0<br/>
        ï¼ˆä¹‹å¾Œè¦åŠ èªè¨€ä»»å‹™ï¼šä¾‹å¦‚ <span class="kbd">I want an apple</span> ä¹Ÿèƒ½åœ¨é€™ä»½éª¨æ¶ä¸Šæ“´å……ã€‚ï¼‰
      </div>
    </div>
  </div>

<script>
(() => {
  // ========= Basic Data =========
  const fruits = ["ğŸ","ğŸŒ","ğŸ‡","ğŸ“","ğŸ","ğŸ¥","ğŸ’","ğŸ‘","ğŸ‰","ğŸŠ","ğŸ","ğŸ‹"];

  // Game state
  const state = {
    reels: ["ğŸ","ğŸŒ","ğŸ‡"],
    score: 0,
    lastGain: 0,
    spins: 0,
    // If you want mirror duel later: make this seedable.
    // seed: null
  };

  // ========= DOM =========
  const $r = [document.getElementById("r0"), document.getElementById("r1"), document.getElementById("r2")];
  const $score = document.getElementById("score");
  const $gain = document.getElementById("gain");
  const $spins = document.getElementById("spins");
  const $msg = document.getElementById("msg");
  const $btnSpin = document.getElementById("btnSpin");
  const $btnReset = document.getElementById("btnReset");

  function setMsg(text, mood="") {
    $msg.textContent = text;
    $msg.className = "msg" + (mood ? (" " + mood) : "");
  }

  function render() {
    $r[0].textContent = state.reels[0];
    $r[1].textContent = state.reels[1];
    $r[2].textContent = state.reels[2];
    $score.textContent = String(state.score);
    $gain.textContent = String(state.lastGain);
    $spins.textContent = String(state.spins);
    postState(); // optional for SS parent
  }

  // ========= Scoring =========
  function calcGain(a,b,c) {
    if (a === b && b === c) return 100;
    if (a === b || b === c || a === c) return 20;
    return 0;
  }

  // ========= Spin =========
  let spinning = false;

  function randomFruit() {
    return fruits[Math.floor(Math.random() * fruits.length)];
  }

  function spin() {
    if (spinning) return;
    spinning = true;
    $btnSpin.disabled = true;

    // Tiny "animation" without canvas: swap emojis a few times.
    let ticks = 0;
    const anim = setInterval(() => {
      state.reels = [randomFruit(), randomFruit(), randomFruit()];
      render();
      ticks++;
      if (ticks >= 10) {
        clearInterval(anim);

        const [a,b,c] = state.reels;
        const gain = calcGain(a,b,c);
        state.lastGain = gain;
        state.score += gain;
        state.spins += 1;

        if (gain === 100) setMsg("ğŸ‰ ä¸‰é€£ï¼+100", "good");
        else if (gain === 20) setMsg("âœ¨ å…©é€£ï¼+20", "good");
        else setMsg("å†ä¾†ä¸€æ¬¡ï½ +0", "");

        // reward event for RR/SS usage
        postReward(gain);

        render();
        spinning = false;
        $btnSpin.disabled = false;
      }
    }, 55);
  }

  function resetGame() {
    state.reels = ["ğŸ","ğŸŒ","ğŸ‡"];
    state.score = 0;
    state.lastGain = 0;
    state.spins = 0;
    setMsg("å·²é‡ç½®ã€‚æŒ‰ A / Start é–‹å§‹ Spinã€‚");
    render();
  }

  // ========= GG / Keyboard Controls =========
  // Key mapping:
  // - A / Space / Enter -> SPIN
  // - B -> RESET
  document.addEventListener("keydown", (e) => {
    const k = (e.key || "").toLowerCase();
    if (k === "a" || e.key === " " || e.key === "enter") {
      e.preventDefault();
      spin();
    } else if (k === "b") {
      e.preventDefault();
      resetGame();
    }
  });

  $btnSpin.addEventListener("click", spin);
  $btnReset.addEventListener("click", resetGame);

  // ========= postMessage Protocol (optional) =========
  // Accept actions from parent (GG / SS) and send state/reward back.
  // Parent -> Game: { type:"action", action:"A"|"B"|"START" }
  // Game -> Parent: { type:"state", state:{...} }
  // Game -> Parent: { type:"reward", reward:number }
  function postState() {
    if (!window.parent || window.parent === window) return;
    window.parent.postMessage({ type: "state", state: { ...state } }, "*");
  }
  function postReward(reward) {
    if (!window.parent || window.parent === window) return;
    window.parent.postMessage({ type: "reward", reward }, "*");
  }

  window.addEventListener("message", (event) => {
    const data = event.data;
    if (!data || typeof data !== "object") return;

    if (data.type === "action") {
      const act = String(data.action || "").toUpperCase();
      if (act === "A" || act === "START" || act === "SPIN") spin();
      if (act === "B" || act === "RESET") resetGame();
    }
  });

  // ========= Boot =========
  render();
})();
</script>
</body>
</html>
